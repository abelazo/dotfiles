#!/usr/bin/env bash

set -euo pipefail

source "$DOTFILES_PATH/scripts/core/_main.sh"

##? Get password from 1password
#?? 2.0.0
##?
##? Usage:
##?   1password <item> [--otp] [--stdout]
docs::eval "$@"

# 1password7 authentication method. It assumes "my" has been already configured
# eval $(op signin --account my)
# The combination of 1password 8 + 1password CLI 2.0 supports biometric authentication

if [ "${otp}" = "true" ]; then
  result=$(op item get ${item} --field type=otp --format json | jq -r .totp)
else
  result=$(op item get ${item} --fields label=password --format human-readable)
fi

if [ "${stdout}" = "true" ]; then
  echo ${result}
else
  echo ${result} | pbcopy
fi
